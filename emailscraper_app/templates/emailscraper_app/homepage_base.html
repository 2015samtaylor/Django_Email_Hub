{% extends 'emailscraper_app/base.html' %}
{% load static %}
{% block title %}
Email Campaign - Home
{% endblock title %}

{% block extra_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/homepage_base.css' %}">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% endblock %}

{% block content %}
<h1>{{ email_context.welcome_message }}</h1>
<div class="container">
    <form action="{% url 'email_config_home' %}" method="post" class="email-configuration-form" enctype="multipart/form-data">
        {% csrf_token %}
        <!-- Hidden input to store selected file ID, and URL -->
        <input type="hidden" id="selected-file-id" name="selected_file_id" value="{{ selected_file_id }}">
        <input type="hidden" id="selected-file-url" name="selected_file_url" value="">
        
        <div class="flex-container">
            <!-- Email configuration container -->
            <div class="email-config-container">

                <p class="form-field">
                    {{ email_config_form.priority_status.label_tag }}<br>
                    {{ email_config_form.priority_status }}  <!-- Render the dropdown field -->
                    {% if email_config_form.priority_status.errors %}
                        <span class="error-message">{{ email_config_form.priority_status.errors }}</span>
                    {% endif %}
                </p>
            
                <div class="button-container">
                    <!-- need to see if the save button is necessary before the -->
                    <button type="submit" class="save-configuration-button">Save Configuration</button>  
                    <button type="submit" class="send-emails-button" formaction="{% url 'email_send' %}">Send Emails</button>
                </div>
            </div>

            <!-- Email content container -->
            <div class="email-content-container">
                {% for field in email_config_form %}
                    {% if field.name == 'email_content' %}
                        <p class="form-field">
                            {{ field.label_tag }}<br>
                            <textarea name="{{ field.name }}" id="editor">{{ field.value }}</textarea>
                            {% if field.errors %}
                                <span class="error-message">{{ field.errors }}</span>
                            {% endif %}
                        </p>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </form>
</div>
<script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/classic/ckeditor.js"></script>
<script>
    ClassicEditor
        .create(document.querySelector('#editor'), {
            ckfinder: {
                uploadUrl: '{% url "ckeditor_upload" %}',
            },
        })
        .catch(error => {
            console.error(error);
        });
</script>
{% endblock content %}

{% block footer %}
<!-- Create a form input when the Send Email Button is hit, the stipulation is the Desired Finish Date is selected as well as priority status -->

    <!-- Initialize Flatpickr for Date and Time input -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        flatpickr(".datetimepicker", {
            enableTime: true,   // Enable time selection
            dateFormat: "Y-m-d H:i",  // Format for date and time
            minDate: "today",   // Prevent selection of past dates
            time_24hr: true     // Use 24-hour format
        });
    </script>

{% endblock footer %}


      


